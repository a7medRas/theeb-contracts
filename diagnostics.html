<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Theeb Worker Diagnostics</title>
<style>
 body{font-family:system-ui,Segoe UI,Arial;background:#0b1016;color:#e5e7eb;padding:24px}
 .card{background:#0f172a;border:1px solid #334155;border-radius:14px;padding:16px;max-width:900px;margin:auto}
 input{width:100%;padding:10px;border-radius:10px;border:1px solid #334155;background:#0b1016;color:#e5e7eb}
 button{padding:10px 12px;border-radius:10px;border:0;background:#3b82f6;color:#fff;font-weight:600;cursor:pointer}
 .row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
 pre{background:#020617;padding:12px;border-radius:10px;overflow:auto;max-height:50vh}
 small{color:#94a3b8}
</style>
<div class="card">
  <h2>Worker Diagnostics</h2>
  <div class="row">
    <input id="ep" placeholder="https://your-worker.your-subdomain.workers.dev/upload">
    <button onclick="ping()">/ping</button>
    <button onclick="upload()">رفع TEST</button>
  </div>
  <small>ضع عنوان /upload. زر /ping هيستخدم العنوان بدون /upload.</small>
  <pre id="out">—</pre>
</div>
<script>
  const out = document.getElementById('out');
  function log(x){ out.textContent = (typeof x==='string')?x:JSON.stringify(x,null,2); }
  function base(ep){ return ep.replace(/\/upload$/,''); }
  async function ping(){
    const ep = document.getElementById('ep').value.trim();
    try{
      const r = await fetch(base(ep) + '/ping');
      const j = await r.json();
      log({status:r.status, headers:Object.fromEntries(r.headers), body:j});
    }catch(e){ log(String(e)); }
  }
  async function upload(){
    const ep = document.getElementById('ep').value.trim();
    try{
      const fd = new FormData();
      fd.append('file', new Blob(['hello'],{type:'application/pdf'}), 'TEST.pdf');
      const r = await fetch(ep + '?name=TEST.pdf&folder=/TheebContracts', { method:'POST', body: fd });
      let b='(no body)'; try{ b = await r.json(); }catch(e){}
      log({status:r.status, headers:Object.fromEntries(r.headers), body:b});
    }catch(e){ log(String(e)); }
  }
</script>
