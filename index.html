<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ุนูุฏ ุตุงูุน ูุญุชูู โ ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท</title>

<!-- Cairo font -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{--bg:#0b0f14;--card:#121823;--ink:#e9eef7;--muted:#a9b4c4;--line:#233044;}
  *{box-sizing:border-box}
  body{margin:0;font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Kufi Arabic",sans-serif;background:linear-gradient(180deg,#0b0f14,#0e1520 30%,#0b0f14);color:var(--ink)}
  header{padding:14px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(11,15,20,.7);backdrop-filter:blur(8px);z-index:5}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;border-radius:10px;background:radial-gradient(circle at 30% 30%,#79ffe1,#4cc9f0 40%,#4361ee 80%);box-shadow:0 0 0 2px #172030 inset}
  h1{font-size:16px;margin:0}
  .lang-toggle{display:flex;gap:8px}
  .lang-toggle button{border:1px solid var(--line);background:#0f172a;color:var(--ink);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600;font-size:13px}

  .wrap{display:grid;grid-template-columns:380px 1fr;gap:16px;padding:16px;align-items:start}
  @media (max-width:1024px){.wrap{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .card h2{margin:0 0 10px 0;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input,textarea{width:100%;background:#0c131e;color:var(--ink);border:1px solid #1e293b;border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
  input[readonly]{opacity:.7;cursor:not-allowed}
  textarea{min-height:84px;resize:vertical}
  .hint{font-size:12px;color:var(--muted)}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  button{border:1px solid var(--line);background:#0f172a;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  .primary{background:linear-gradient(90deg,#3a86ff,#4cc9f0);color:#071019;border:none}
  .success{background:linear-gradient(90deg,#16a34a,#22c55e);color:#05130a;border:none}
  .ghost{background:transparent}

  /* ูุซููุฉ ุงูุนูุฏ */
  .doc{
    background:#fff;color:#111;border-radius:16px;padding:28px;border:1px solid #e5e7eb;position:relative;
    width:794px;             /* ุชุซุจูุช ุนุฑุถ A4 ุนูู ุงูุดุงุดุฉ */
    margin:0 auto;
  }
  .doc h1{font-size:20px;color:#0f172a}
  .meta{display:flex;gap:18px;flex-wrap:wrap;color:#334155;font-size:13px;margin:8px 0 14px}
  .hr{height:1px;background:#e5e7eb;margin:14px 0 16px}
  .kv{display:grid;grid-template-columns:110px 1fr;gap:10px;margin:6px 0}
  .section h3{font-size:15px;margin:14px 0 8px}
  .section p{line-height:1.9;margin:4px 0;font-size:14px}
  .list{margin:0;padding:0 18px}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe}
  table{width:100%;border-collapse:collapse;margin:10px 0}
  th,td{border:1px solid #e5e7eb;padding:8px;font-size:13px}
  th{background:#f8fafc}
  .signs{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:24px}
  .signBox{min-height:90px;border:1px dashed #cbd5e1;border-radius:10px;padding:8px;font-size:12px;color:#475569}
  .tiny{font-size:12px;color:#64748b}
  .id-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .id-card{border:1px dashed #cbd5e1;border-radius:12px;padding:8px;text-align:center;background:#fafafa}
  .id-card img{max-width:100%;height:auto;border-radius:8px;display:block;margin:6px auto}
  .id-card .cap{font-size:12px;color:#475569}

  /* ููุญุฉ ุงูุชูููุน */
  .sig-wrap{border:1px dashed #334155;border-radius:12px;padding:10px;background:#0b1220}
  .sig-toolbar{display:flex;gap:8px;margin-bottom:8px;align-items:center}
  .sig-toolbar button{padding:6px 10px;border-radius:10px;font-size:12px}
  .sig-canvas{width:100%;height:160px;background:#fff;border-radius:10px;touch-action:none;cursor:crosshair;display:block}
  .sig-note{font-size:11px;color:#94a3b8;margin-top:4px}

  /* ุงูุนูุงูุฉ ุงููุงุฆูุฉ */
  .watermark{position:absolute;inset:0;pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:90px;font-weight:700;color:rgba(0,0,0,0.05);transform:rotate(-25deg);z-index:0;white-space:nowrap;user-select:none}
  .doc *:not(.watermark){position:relative;z-index:1}
  .head{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .doc .logo{width:42px;height:42px;border-radius:12px;background:radial-gradient(circle at 30% 30%,#79ffe1,#4cc9f0 40%,#4361ee 80%);box-shadow:0 0 0 2px #e5e7eb inset}
  .title{display:flex;align-items:center;gap:10px}

  /* ุทุจุงุนุฉ (ููุชุญูู ูู ุญุฏ ุถุบุท Ctrl+P) */
  @media print{
    body{background:#fff}
    header,.card.form{display:none !important}
    .wrap{display:block;padding:0}
    .doc{border:none;border-radius:0;box-shadow:none;padding:16mm}
    .watermark{font-size:120px}
    img,canvas{image-rendering:auto}
    @page{size:A4;margin:12mm}
  }
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <h1 data-i18n="title">ุนูุฏ ุตุงูุน ูุญุชูู โ ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท</h1>
  </div>
  <div class="lang-toggle">
    <button id="langAr">ุนุฑุจู</button>
    <button id="langEn">English</button>
  </div>
</header>

<div class="wrap">
  <!-- ุงููููุฐุฌ -->
  <section class="card form">
    <h2 data-i18n="form.contractData">ุจูุงูุงุช ุงูุนูุฏ</h2>
    <div class="row">
      <div>
        <label data-i18n="form.date">ุชุงุฑูุฎ ุงูุนูุฏ</label>
        <input type="date" id="contractDate" />
      </div>
      <div>
        <label data-i18n="form.place">ููุงู ุงูุชูููุน</label>
        <input type="text" id="place" placeholder="ุงููุงูุฑุฉ โ ูุตุฑ" value="ุงููุงูุฑุฉ โ ูุตุฑ" />
      </div>
    </div>

    <h2 style="margin-top:12px" data-i18n="form.party1">ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)</h2>
    <div class="row">
      <div>
        <label data-i18n="form.agencyName">ุงุณู ุงูููุงูุฉ</label>
        <input type="text" id="agencyName" value="THEEB EG-M1472" readonly />
      </div>
      <div>
        <label data-i18n="form.taxId">ุงูุณุฌู/ุงูุฑูู ุงูุถุฑูุจู (ุงุฎุชูุงุฑู)</label>
        <input type="text" id="agencyReg" value="NO.898989--t" readonly />
      </div>
    </div>
    <div class="row">
      <div>
        <label data-i18n="form.agencyRep">ููุซู ุงูููุงูุฉ</label>
        <input type="text" id="agencyRep" value="Ahmed Rashed" readonly />
      </div>
      <div>
        <label data-i18n="form.phone">ุงููุงุชู</label>
        <input type="tel" id="agencyPhone" value="00201091545443" readonly />
      </div>
    </div>
    <div>
      <label data-i18n="form.address">ุงูุนููุงู</label>
      <input type="text" id="agencyAddr" value="Egypt โ Monufia โ Shebin El Kom" readonly />
    </div>
    <div class="hint" data-i18n="form.party1Fixed">* ุจูุงูุงุช ุงูุทุฑู ุงูุฃูู ุซุงุจุชุฉ ููุง ุทูุจุช.</div>

    <h2 style="margin-top:12px" data-i18n="form.party2">ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)</h2>
    <div class="row">
      <div>
        <label data-i18n="form.name">ุงูุงุณู</label>
        <input type="text" id="creatorName" placeholder="ุงูุงุณู ุงูุซูุงุซู" />
      </div>
      <div>
        <label data-i18n="form.idNum">ุฑูู ุงููููุฉ/ุงูุฌูุงุฒ</label>
        <input type="text" id="creatorId" placeholder="โ" />
      </div>
    </div>
    <div class="row">
      <div>
        <label data-i18n="form.phone2">ุงููุงุชู</label>
        <input type="tel" id="creatorPhone" placeholder="+20โฆ" />
      </div>
      <div>
        <label data-i18n="form.email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" id="creatorEmail" placeholder="name@email.com" />
      </div>
    </div>
    <div class="row">
      <div>
        <label data-i18n="form.likee">ูุนุฑูู Likee</label>
        <input type="text" id="creatorLikee" placeholder="Likee ID" />
      </div>
      <div>
        <label data-i18n="form.address2">ุงูุนููุงู</label>
        <input type="text" id="creatorAddr" placeholder="ุงูุนููุงู ุงููุงูู" />
      </div>
    </div>

    <h2 style="margin-top:12px" data-i18n="form.idPhotos">ุตูุฑ ุงููููุฉ (ุงูุทุฑู ุงูุซุงูู)</h2>
    <div class="row">
      <div>
        <label data-i18n="form.idFront">ูุฌู ุงููููุฉ (Front)</label>
        <input type="file" id="idFront" accept="image/*" />
      </div>
      <div>
        <label data-i18n="form.idBack">ุธูุฑ ุงููููุฉ (Back)</label>
        <input type="file" id="idBack" accept="image/*" />
      </div>
    </div>
    <div class="hint" data-i18n="form.idNote">* ุชูุฏูุฌ ุงูุตูุฑ ุฏุงุฎู ุงูุนูุฏ ุชููุงุฆููุง ุนูุฏ ุงูุญูุธ PDF.</div>

    <h2 style="margin-top:12px" data-i18n="form.signatures">ุงูุชูููุนุงุช ุงูุฑูููุฉ</h2>
    <div class="sig-wrap">
      <div class="sig-toolbar">
        <strong style="font-size:13px" data-i18n="sig.agency">ุชูููุน ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)</strong>
        <span style="flex:1"></span>
        <button type="button" class="ghost" id="sigAgencyClear" data-i18n="sig.clear">ูุณุญ</button>
        <button type="button" class="primary" id="sigAgencySave" data-i18n="sig.save">ุญูุธ ุงูุชูููุน</button>
      </div>
      <canvas class="sig-canvas" id="sigAgency" width="900" height="300"></canvas>
      <div class="sig-note" data-i18n="sig.note">ุงุฑุณู ุชูููุนู ุจุงููุงูุณ ุฃู ุงูุฅุตุจุน ุซู ุงุถุบุท ุญูุธ.</div>
    </div>
    <div style="height:8px"></div>
    <div class="sig-wrap">
      <div class="sig-toolbar">
        <strong style="font-size:13px" data-i18n="sig.creator">ุชูููุน ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)</strong>
        <span style="flex:1"></span>
        <button type="button" class="ghost" id="sigCreatorClear" data-i18n="sig.clear">ูุณุญ</button>
        <button type="button" class="primary" id="sigCreatorSave" data-i18n="sig.save">ุญูุธ ุงูุชูููุน</button>
      </div>
      <canvas class="sig-canvas" id="sigCreator" width="900" height="300"></canvas>
      <div class="sig-note" data-i18n="sig.note">ุงุฑุณู ุชูููุนู ุจุงููุงูุณ ุฃู ุงูุฅุตุจุน ุซู ุงุถุบุท ุญูุธ.</div>
    </div>

    <h2 style="margin-top:12px" data-i18n="form.targets">ุงูุชุงุฑุฌูุช ุงูุดูุฑู</h2>
    <div class="hint" data-i18n="form.targetsHint">ุญุฑูุฑ ุงูุฌุฏููุ ูุฃุถูู ุตููููุง ุญุณุจ ุงูุญุงุฌุฉ.</div>
    <table id="targetTable">
      <thead>
        <tr><th data-i18n="table.month">ุงูุดูุฑ</th><th data-i18n="table.target">ุงูุชุงุฑุฌูุช</th><th data-i18n="table.pay">ุงูููุงุจู (ุฌููู/ุฏููุงุฑ)</th></tr>
      </thead>
      <tbody contenteditable="true">
        <tr><td data-i18n="m.jan">ููุงูุฑ</td><td>โ</td><td>โ</td></tr>
        <tr><td data-i18n="m.feb">ูุจุฑุงูุฑ</td><td>โ</td><td>โ</td></tr>
      </tbody>
    </table>
    <div class="btns">
      <button class="ghost" id="addRowBtn" data-i18n="btn.addRow">+ ุฅุถุงูุฉ ุตู</button>
    </div>

    <div class="btns">
      <button class="primary" id="applyBtn" data-i18n="btn.apply">ุชุญุฏูุซ ุงููุนุงููุฉ</button>
      <button class="success" id="savePdfBtn">๐พ <span data-i18n="btn.print">ุญูุธ PDF</span></button>
      <button id="clearBtn" data-i18n="btn.clear">ูุณุญ ุงูุญููู</button>
    </div>
    <div class="hint" data-i18n="form.autoSave">ูุชู ุญูุธ ุงููุณูุฏุฉ ุชููุงุฆููุง ุนูู ุฌูุงุฒู.</div>
  </section>

  <!-- ุงูุนูุฏ -->
  <section class="card">
    <div class="doc" id="doc">
      <div class="watermark">THEEB.EG</div>

      <div class="head">
        <div class="title">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1 data-i18n="doc.title">ุนูุฏ ุตุงูุน ุงููุญุชูู</h1>
            <div class="tiny">
              <span data-i18n="doc.between">ุจูู:</span>
              <span id="pAgencyName">THEEB EG-M1472</span>
              <span data-i18n="doc.party1">(ุงูุทุฑู ุงูุฃูู)</span>
              <span data-i18n="doc.and">ู</span>
              <span id="pCreatorName">โ</span>
              <span data-i18n="doc.party2">(ุงูุทุฑู ุงูุซุงูู)</span>
            </div>
          </div>
        </div>
        <span class="badge" data-i18n="doc.badge">ุณุฑู โ ููุงุณุชุฎุฏุงู ุงูุชุนุงูุฏู</span>
      </div>

      <div class="meta">
        <div><span data-i18n="doc.date">ุชุงุฑูุฎ ุงูุนูุฏ:</span> <strong id="pDate">โ</strong></div>
        <div><span data-i18n="doc.place">ุงูููุงู:</span> <strong id="pPlace">ุงููุงูุฑุฉ โ ูุตุฑ</strong></div>
      </div>
      <div class="hr"></div>

      <div class="section">
        <h3 data-i18n="doc.preambleTitle">ุชูููุฏ:</h3>
        <p data-i18n="doc.preambleText">ุชูู ุงูุงุชูุงู ุจูู ุงูุทุฑููู ุงูููุถูุญูู ุฃุฏูุงู ุนูู ุฅุจุฑุงู ูุฐุง ุงูุนูุฏุ ูููุนุชุจุฑ ูุง ููุฑูุฏ ููู ูู ุจููุฏ ูููุฒูููุง ููุทุฑููู:</p>
        <div class="kv"><div data-i18n="doc.party1Label">ุงูุทุฑู ุงูุฃูู:</div><div id="pAgencyBlock"></div></div>
        <div class="kv"><div data-i18n="doc.party2Label">ุงูุทุฑู ุงูุซุงูู:</div><div id="pCreatorBlock"></div></div>
      </div>

      <div class="hr"></div>

      <div class="section" id="clauses">
        <h3 data-i18n="doc.clausesTitle">๐ ุจููุฏ ุนูุฏ ุตุงูุน ุงููุญุชูู โ ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท</h3>

        <p data-i18n="c1"><strong>ุงูุจูุฏ ุงูุฃูู โ ููุถูุน ุงูุนูุฏ:</strong><br>ูุชุนูุฏ ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ุจุฅูุชุงุฌ ููุดุฑ ูุญุชูู ูุฑุฆู ูุตูุชู ุนูู ููุตุฉ Likee ุจูุง ูุชูุงูู ูุน ุงููุนุงููุฑ ุงููุญุฏุฏุฉ ูู ูุจู ุงูุทุฑู ุงูุฃูู (ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท)ุ ูุฐูู ููุงุจู ุงูุฃุฌุฑ ุงููุญุฏุฏ ูู ูุฐุง ุงูุนูุฏ.</p>

        <p data-i18n="c2"><strong>ุงูุจูุฏ ุงูุซุงูู โ ูุฏุฉ ุงูุนูุฏ:</strong><br>ุชุจุฏุฃ ูุฏุฉ ูุฐุง ุงูุนูุฏ ูู ุชุงุฑูุฎ ุชูููุนู ูููุฏุฉ ุฃุฑุจุน (4) ุณููุงุช ูุงุจูุฉ ููุชุฌุฏูุฏ ุจุงุชูุงู ุงูุทุฑููู ูุชุงุจุฉู.</p>

        <p data-i18n="c3"><strong>ุงูุจูุฏ ุงูุซุงูุซ โ ุงูุฃุฌุฑ ูุงููุณุชุญูุงุช:</strong><br>ุงูุฃุฌุฑ ููุญุณุจ ุดูุฑููุง ููููุง ูุชุญููู ุงูุชุงุฑุฌูุช ุงููุญุฏุฏ ููู ุดูุฑุ ูุฐูู ุญุณุจ ุฌุฏูู ุงูุชุงุฑุฌูุช ุงููุฑูู ูุงููุนุชูุฏ ูู ุงูุทุฑู ุงูุฃูู. ูุชู ุตุฑู ุงููุณุชุญูุงุช ุฎูุงู ูุฏุฉ ุฃูุตุงูุง (15) ููู ุนูู ูู ููุงูุฉ ูู ุดูุฑ.</p>

        <p data-i18n="c4Title"><strong>ุงูุจูุฏ ุงูุฑุงุจุน โ ุงูุชุฒุงูุงุช ุตุงูุน ุงููุญุชูู:</strong></p>
        <ol class="list" data-i18n-list="c4List">
          <li>ุงูุงูุชุฒุงู ุจูุดุฑ ุนุฏุฏ ูููุน ุงููุญุชูู ุงููุทููุจ ุญุณุจ ุฎุทุฉ ุงูุนูู.</li>
          <li>ุงูุงูุชุฒุงู ุจุฌููุน ููุงููู ูุณูุงุณุงุช ููุตุฉ Likee.</li>
          <li>ุงูุญูุงุธ ุนูู ุตูุฑุฉ ูุงุฆูุฉ ูุดูู ูููู ูู ุฌููุน ุงูุฃุนูุงู ุงูููุดูุฑุฉ.</li>
          <li>ุนุฏู ุงูุนูู ุฃู ุงูุชุนุงูู ูุน ุฃู ููุตุงุช ุฃู ุฌูุงุช ููุงูุณุฉ ุทูุงู ูุชุฑุฉ ุงูุนูุฏ.</li>
          <li>ุงูุงูุชุฒุงู ุจููุงุนูุฏ ุงููุดุฑ ุงููุญุฏุฏุฉ ูู ุงูุทุฑู ุงูุฃูู.</li>
        </ol>

        <p data-i18n="c5Title"><strong>ุงูุจูุฏ ุงูุฎุงูุณ โ ุงูุชุฒุงูุงุช ุงูููุงูุฉ:</strong></p>
        <ol class="list" data-i18n-list="c5List">
          <li>ุชูููุฑ ุงูุฏุนู ุงูููู ูุงูุฅุฑุดุงุฏุงุช ุงููุงุฒูุฉ ููุฌุงุญ ุตุงูุน ุงููุญุชูู.</li>
          <li>ุชูุฏูู ุงูุชุฏุฑูุจ ูุงููุชุงุจุนุฉ ุงูุฏูุฑูุฉ ูุถูุงู ุฌูุฏุฉ ุงููุญุชูู.</li>
          <li>ุตุฑู ุงููุณุชุญูุงุช ูู ููุงุนูุฏูุง ููู ุงูุดุฑูุท ุงููุชูู ุนูููุง.</li>
        </ol>

        <p data-i18n="c6"><strong>ุงูุจูุฏ ุงูุณุงุฏุณ โ ุงูููููุฉ ุงูููุฑูุฉ:</strong><br>ุฌููุน ุงูุญููู ุงููุชุนููุฉ ุจุงููุญุชูู ุงูุฐู ููุชุฌู ุงูุทุฑู ุงูุซุงูู ุฎูุงู ูุชุฑุฉ ุงูุนูุฏ ุชุนูุฏ ููููุชูุง ููุทุฑู ุงูุฃููุ ููุง ูุญู ููุทุฑู ุงูุซุงูู ุฅุนุงุฏุฉ ูุดุฑ ุฃู ุจูุน ูุฐุง ุงููุญุชูู ุฏูู ููุงููุฉ ูุชุงุจูุฉ ูู ุงูุทุฑู ุงูุฃูู.</p>

        <p data-i18n="c7"><strong>ุงูุจูุฏ ุงูุณุงุจุน โ ุฅููุงุก ุงูุนูุฏ:</strong><br>ูุฌูุฒ ูุฃู ูู ุงูุทุฑููู ุฅููุงุก ุงูุนูุฏ ุจุฅุดุนุงุฑ ูุชุงุจู ููุทุฑู ุงูุขุฎุฑ ูุจู ูุฏุฉ ูุง ุชูู ุนู (30) ููููุงุ ุนูู ุฃู ููุชุฒู ุงูุทุฑูุงู ุจุชุตููุฉ ุฌููุน ุงูุงูุชุฒุงูุงุช ุงููุงููุฉ ูุงููุงููููุฉ.</p>

        <p data-i18n="c8"><strong>ุงูุจูุฏ ุงูุซุงูู โ ุฃุญูุงู ุนุงูุฉ:</strong><br>ูู ุญุงู ุญุฏูุซ ุฎูุงู ุจูู ุงูุทุฑูููุ ูุชู ุญูู ูุฏููุงุ ูุฅุฐุง ุชุนุฐุฑ ุฐูู ููุญุงู ุงููุฒุงุน ุฅูู ุงูุฌูุงุช ุงููุถุงุฆูุฉ ุงููุฎุชุตุฉ. ูุนุชุจุฑ ูุฐุง ุงูุนูุฏ ุจูุงูู ุจููุฏู ููุฒููุง ููุทุฑููู ุจูุฌุฑุฏ ุชูููุนู.</p>

        <p data-i18n="c9"><strong>ุงูุจูุฏ ุงูุชุงุณุน โ ุญุตุฑูุฉ ุงูุชุนุงูุฏ:</strong><br>ูู ุญุงู ุงูุชุดุงู ุฃู ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ูุณุฌู ุฃู ูุชุนุงูุฏ ูุน ููุงูุฉ ุฃุฎุฑู ุฎูุงู ูุชุฑุฉ ุณุฑูุงู ูุฐุง ุงูุนูุฏุ ูุญู ููุทุฑู ุงูุฃูู (ุงูููุงูุฉ) ุงุชุฎุงุฐ ุงูุฅุฌุฑุงุกุงุช ุงููุงุฒูุฉ ูู ุฎูุงู ุฅุฏุงุฑุฉ ุงูุชุทุจููุ ุจูุง ูู ุฐูู ุฅููุงู ุงููุดุงุท ุฃู ุฅููุงุก ุงูุชุนุงูุฏ ููุฑูุง ุฏูู ุฃู ุชุนููุถ.</p>

        <p data-i18n="c10"><strong>ุงูุจูุฏ ุงูุนุงุดุฑ โ ุงูุญู ูู ุงููุทุงูุจุฉ ุงููุงููููุฉ:</strong><br>ูุญู ููุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ุงููุฌูุก ุฅูู ุงูุฌูุงุช ุงููุงููููุฉ ุงููุฎุชุตุฉ ูููุงุถุงุฉ ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ) ูู ุญุงู ุนุฏู ุงุณุชูุงู ุงูุฃุฌุฑ ุงููุชูู ุนููู ูู ุงูููุงุนูุฏ ุงููุญุฏุฏุฉุ ูุน ุงุญุชูุงุธู ุจูุงูุฉ ุญูููู ุงููุงููุฉ ูุงููุงููููุฉ.</p>
      </div>

      <div class="section">
        <h3 data-i18n="doc.tableTitle">๐ ุฌุฏูู ุงูุชุงุฑุฌูุช ุงููุฑูู</h3>
        <div id="pTargetTable"></div>
        <div class="tiny" data-i18n="doc.tableNote">* ุงูุฌุฏูู ุฌุฒุก ูุง ูุชุฌุฒุฃ ูู ุงูุนูุฏ ููุฌูุฒ ุชุญุฏูุซู ุจุงุชูุงู ุงูุทุฑููู ูุชุงุจููุง.</div>
      </div>

      <div class="section">
        <h3 data-i18n="doc.idTitle">๐ชช ุตูุฑ ูููุฉ ุงูุทุฑู ุงูุซุงูู</h3>
        <div class="id-grid">
          <div class="id-card">
            <div class="cap" data-i18n="doc.idFrontCap">ูุฌู ุงููููุฉ (Front)</div>
            <img id="pIdFront" alt="ID Front" />
          </div>
          <div class="id-card">
            <div class="cap" data-i18n="doc.idBackCap">ุธูุฑ ุงููููุฉ (Back)</div>
            <img id="pIdBack" alt="ID Back" />
          </div>
        </div>
        <div class="tiny" style="margin-top:6px" data-i18n="doc.idNote">* ุชูุณุชุฎุฏู ุงูุตูุฑ ูุฃุบุฑุงุถ ุงูุชุนุงูุฏ ููุท.</div>
      </div>

      <div class="signs">
        <div>
          <strong data-i18n="doc.signAgency">ุชูููุน ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)</strong>
          <div class="signBox">
            <div><span data-i18n="doc.name">ุงูุงุณู:</span> <span id="pAgencyRepSign">Ahmed Rashed</span></div>
            <div style="margin-top:6px"><img id="pAgencySig" alt="Agency Signature" style="max-width:100%;height:auto"/></div>
          </div>
        </div>
        <div>
          <strong data-i18n="doc.signCreator">ุชูููุน ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)</strong>
          <div class="signBox">
            <div><span data-i18n="doc.name">ุงูุงุณู:</span> <span id="pCreatorSign">โ</span></div>
            <div style="margin-top:6px"><img id="pCreatorSig" alt="Creator Signature" style="max-width:100%;height:auto"/></div>
          </div>
        </div>
      </div>

      <div class="tiny" style="margin-top:12px">
        <span data-i18n="doc.footer1">ุชูู ุชุญุฑูุฑ ูุฐุง ุงูุนูุฏ ุจุชุงุฑูุฎ</span> <span id="pDate2">โ</span>
        <span data-i18n="doc.footer2">ูู</span> <span id="pPlace2">โ</span>
        <span data-i18n="doc.footer3">ูุจูุณุฎุชูู ุฃุตููุชูู ุจูุฏ ูู ุทุฑู ูุณุฎุฉ.</span>
      </div>
    </div>

    <div class="btns" style="margin-top:12px">
      <button class="success" id="savePdfBtn2">๐พ <span data-i18n="btn.print">ุญูุธ PDF</span></button>
    </div>
  </section>
</div>

<!-- ======== ููุชุจุงุช: ูุญูู ุฃููุงู ุซู CDN ุงุญุชูุงุทู ======== -->
<script src="assets/js/html2canvas.min.js"></script>
<script>
  if (typeof html2canvas === 'undefined') {
    var s = document.createElement('script');
    s.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
    document.head.appendChild(s);
  }
</script>

<script src="assets/js/jspdf.umd.min.js"></script>
<script>
  if (!(window.jspdf && window.jspdf.jsPDF)) {
    var s = document.createElement('script');
    s.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
    document.head.appendChild(s);
  }
</script>

<script>
  const $ = (id)=>document.getElementById(id);

  /* ====== ุฅุนุฏุงุฏุงุช ุฑูุน Dropbox ุนุจุฑ Cloudflare Worker ====== */
  const UPLOAD_ENDPOINT = 'https://YOUR_WORKER_SUBDOMAIN.workers.dev/upload'; // โ ุบููุฑูุง ุจุฑุงุจุท ุงููWorker
  const DROPBOX_FOLDER  = '/TheebContracts'; // โ ูุณุงุฑ ุฏุงุฎู Dropbox

  async function uploadToDropbox(blob, filename){
    const url = `${UPLOAD_ENDPOINT}?name=${encodeURIComponent(filename)}&folder=${encodeURIComponent(DROPBOX_FOLDER)}`;
    const res = await fetch(url, { method: 'POST', body: blob });
    let data = {};
    try { data = await res.json(); } catch(e){}
    if (!res.ok || !data.ok){
      throw new Error((data && (data.error || data.message)) || `HTTP ${res.status}`);
    }
    return data; // { ok:true, url, path }
  }


  /* ===================== i18n ===================== */
  const I18N = {
    ar:{title:"ุนูุฏ ุตุงูุน ูุญุชูู โ ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท",
      form:{contractData:"ุจูุงูุงุช ุงูุนูุฏ",date:"ุชุงุฑูุฎ ุงูุนูุฏ",place:"ููุงู ุงูุชูููุน",party1:"ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)",agencyName:"ุงุณู ุงูููุงูุฉ",taxId:"ุงูุณุฌู/ุงูุฑูู ุงูุถุฑูุจู (ุงุฎุชูุงุฑู)",agencyRep:"ููุซู ุงูููุงูุฉ",phone:"ุงููุงุชู",address:"ุงูุนููุงู",party1Fixed:"* ุจูุงูุงุช ุงูุทุฑู ุงูุฃูู ุซุงุจุชุฉ ููุง ุทูุจุช.",party2:"ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)",name:"ุงูุงุณู",idNum:"ุฑูู ุงููููุฉ/ุงูุฌูุงุฒ",phone2:"ุงููุงุชู",email:"ุงูุจุฑูุฏ ุงูุฅููุชุฑููู",likee:"ูุนุฑูู Likee",address2:"ุงูุนููุงู",idPhotos:"ุตูุฑ ุงููููุฉ (ุงูุทุฑู ุงูุซุงูู)",idFront:"ูุฌู ุงููููุฉ (Front)",idBack:"ุธูุฑ ุงููููุฉ (Back)",idNote:"* ุชูุฏูุฌ ุงูุตูุฑ ุฏุงุฎู ุงูุนูุฏ ุชููุงุฆููุง ุนูุฏ ุงูุญูุธ PDF.",signatures:"ุงูุชูููุนุงุช ุงูุฑูููุฉ",targets:"ุงูุชุงุฑุฌูุช ุงูุดูุฑู",targetsHint:"ุญุฑูุฑ ุงูุฌุฏููุ ูุฃุถูู ุตููููุง ุญุณุจ ุงูุญุงุฌุฉ.",autoSave:"ูุชู ุญูุธ ุงููุณูุฏุฉ ุชููุงุฆููุง ุนูู ุฌูุงุฒู."},
      sig:{agency:"ุชูููุน ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)",creator:"ุชูููุน ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)",clear:"ูุณุญ",save:"ุญูุธ ุงูุชูููุน",note:"ุงุฑุณู ุชูููุนู ุจุงููุงูุณ ุฃู ุงูุฅุตุจุน ุซู ุงุถุบุท ุญูุธ."},
      table:{month:"ุงูุดูุฑ",target:"ุงูุชุงุฑุฌูุช",pay:"ุงูููุงุจู (ุฌููู/ุฏููุงุฑ)"},
      m:{jan:"ููุงูุฑ",feb:"ูุจุฑุงูุฑ"},
      btn:{addRow:"+ ุฅุถุงูุฉ ุตู",apply:"ุชุญุฏูุซ ุงููุนุงููุฉ",print:"ุญูุธ PDF",clear:"ูุณุญ ุงูุญููู"},
      doc:{title:"ุนูุฏ ุตุงูุน ุงููุญุชูู",between:"ุจูู:",party1:"(ุงูุทุฑู ุงูุฃูู)",and:"ู",party2:"(ุงูุทุฑู ุงูุซุงูู)",badge:"ุณุฑู โ ููุงุณุชุฎุฏุงู ุงูุชุนุงูุฏู",date:"ุชุงุฑูุฎ ุงูุนูุฏ:",place:"ุงูููุงู:",preambleTitle:"ุชูููุฏ:",preambleText:"ุชูู ุงูุงุชูุงู ุจูู ุงูุทุฑููู ุงูููุถูุญูู ุฃุฏูุงู ุนูู ุฅุจุฑุงู ูุฐุง ุงูุนูุฏุ ูููุนุชุจุฑ ูุง ููุฑูุฏ ููู ูู ุจููุฏ ูููุฒูููุง ููุทุฑููู:",party1Label:"ุงูุทุฑู ุงูุฃูู:",party2Label:"ุงูุทุฑู ุงูุซุงูู:",clausesTitle:"๐ ุจููุฏ ุนูุฏ ุตุงูุน ุงููุญุชูู โ ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท",idTitle:"๐ชช ุตูุฑ ูููุฉ ุงูุทุฑู ุงูุซุงูู",idFrontCap:"ูุฌู ุงููููุฉ (Front)",idBackCap:"ุธูุฑ ุงููููุฉ (Back)",idNote:"* ุชูุณุชุฎุฏู ุงูุตูุฑ ูุฃุบุฑุงุถ ุงูุชุนุงูุฏ ููุท.",signAgency:"ุชูููุน ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ)",signCreator:"ุชูููุน ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู)",name:"ุงูุงุณู:",tableTitle:"๐ ุฌุฏูู ุงูุชุงุฑุฌูุช ุงููุฑูู",tableNote:"* ุงูุฌุฏูู ุฌุฒุก ูุง ูุชุฌุฒุฃ ูู ุงูุนูุฏ ููุฌูุฒ ุชุญุฏูุซู ุจุงุชูุงู ุงูุทุฑููู ูุชุงุจููุง.",footer1:"ุชูู ุชุญุฑูุฑ ูุฐุง ุงูุนูุฏ ุจุชุงุฑูุฎ",footer2:"ูู",footer3:"ูุจูุณุฎุชูู ุฃุตููุชูู ุจูุฏ ูู ุทุฑู ูุณุฎุฉ."},
      c1:"<strong>ุงูุจูุฏ ุงูุฃูู โ ููุถูุน ุงูุนูุฏ:</strong><br>ูุชุนูุฏ ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ุจุฅูุชุงุฌ ููุดุฑ ูุญุชูู ูุฑุฆู ูุตูุชู ุนูู ููุตุฉ Likee ุจูุง ูุชูุงูู ูุน ุงููุนุงููุฑ ุงููุญุฏุฏุฉ ูู ูุจู ุงูุทุฑู ุงูุฃูู (ููุงูุฉ ุฐูุจ ุงูุดุฑู ุงูุฃูุณุท)ุ ูุฐูู ููุงุจู ุงูุฃุฌุฑ ุงููุญุฏุฏ ูู ูุฐุง ุงูุนูุฏ.",
      c2:"<strong>ุงูุจูุฏ ุงูุซุงูู โ ูุฏุฉ ุงูุนูุฏ:</strong><br>ุชุจุฏุฃ ูุฏุฉ ูุฐุง ุงูุนูุฏ ูู ุชุงุฑูุฎ ุชูููุนู ูููุฏุฉ ุฃุฑุจุน (4) ุณููุงุช ูุงุจูุฉ ููุชุฌุฏูุฏ ุจุงุชูุงู ุงูุทุฑููู ูุชุงุจุฉู.",
      c3:"<strong>ุงูุจูุฏ ุงูุซุงูุซ โ ุงูุฃุฌุฑ ูุงููุณุชุญูุงุช:</strong><br>ุงูุฃุฌุฑ ููุญุณุจ ุดูุฑููุง ููููุง ูุชุญููู ุงูุชุงุฑุฌูุช ุงููุญุฏุฏ ููู ุดูุฑุ ูุฐูู ุญุณุจ ุฌุฏูู ุงูุชุงุฑุฌูุช ุงููุฑูู ูุงููุนุชูุฏ ูู ุงูุทุฑู ุงูุฃูู. ูุชู ุตุฑู ุงููุณุชุญูุงุช ุฎูุงู ูุฏุฉ ุฃูุตุงูุง (15) ููู ุนูู ูู ููุงูุฉ ูู ุดูุฑ.",
      c4Title:"<strong>ุงูุจูุฏ ุงูุฑุงุจุน โ ุงูุชุฒุงูุงุช ุตุงูุน ุงููุญุชูู:</strong>", c4List:["ุงูุงูุชุฒุงู ุจูุดุฑ ุนุฏุฏ ูููุน ุงููุญุชูู ุงููุทููุจ ุญุณุจ ุฎุทุฉ ุงูุนูู.","ุงูุงูุชุฒุงู ุจุฌููุน ููุงููู ูุณูุงุณุงุช ููุตุฉ Likee.","ุงูุญูุงุธ ุนูู ุตูุฑุฉ ูุงุฆูุฉ ูุดูู ูููู ูู ุฌููุน ุงูุฃุนูุงู ุงูููุดูุฑุฉ.","ุนุฏู ุงูุนูู ุฃู ุงูุชุนุงูู ูุน ุฃู ููุตุงุช ุฃู ุฌูุงุช ููุงูุณุฉ ุทูุงู ูุชุฑุฉ ุงูุนูุฏ.","ุงูุงูุชุฒุงู ุจููุงุนูุฏ ุงููุดุฑ ุงููุญุฏุฏุฉ ูู ุงูุทุฑู ุงูุฃูู."],
      c5Title:"<strong>ุงูุจูุฏ ุงูุฎุงูุณ โ ุงูุชุฒุงูุงุช ุงูููุงูุฉ:</strong>", c5List:["ุชูููุฑ ุงูุฏุนู ุงูููู ูุงูุฅุฑุดุงุฏุงุช ุงููุงุฒูุฉ ููุฌุงุญ ุตุงูุน ุงููุญุชูู.","ุชูุฏูู ุงูุชุฏุฑูุจ ูุงููุชุงุจุนุฉ ุงูุฏูุฑูุฉ ูุถูุงู ุฌูุฏุฉ ุงููุญุชูู.","ุตุฑู ุงููุณุชุญูุงุช ูู ููุงุนูุฏูุง ููู ุงูุดุฑูุท ุงููุชูู ุนูููุง."],
      c6:"<strong>ุงูุจูุฏ ุงูุณุงุฏุณ โ ุงูููููุฉ ุงูููุฑูุฉ:</strong><br>ุฌููุน ุงูุญููู ุงููุชุนููุฉ ุจุงููุญุชูู ุงูุฐู ููุชุฌู ุงูุทุฑู ุงูุซุงูู ุฎูุงู ูุชุฑุฉ ุงูุนูุฏ ุชุนูุฏ ููููุชูุง ููุทุฑู ุงูุฃููุ ููุง ูุญู ููุทุฑู ุงูุซุงูู ุฅุนุงุฏุฉ ูุดุฑ ุฃู ุจูุน ูุฐุง ุงููุญุชูู ุฏูู ููุงููุฉ ูุชุงุจูุฉ ูู ุงูุทุฑู ุงูุฃูู.",
      c7:"<strong>ุงูุจูุฏ ุงูุณุงุจุน โ ุฅููุงุก ุงูุนูุฏ:</strong><br>ูุฌูุฒ ูุฃู ูู ุงูุทุฑููู ุฅููุงุก ุงูุนูุฏ ุจุฅุดุนุงุฑ ูุชุงุจู ููุทุฑู ุงูุขุฎุฑ ูุจู ูุฏุฉ ูุง ุชูู ุนู (30) ููููุงุ ุนูู ุฃู ููุชุฒู ุงูุทุฑูุงู ุจุชุตููุฉ ุฌููุน ุงูุงูุชุฒุงูุงุช ุงููุงููุฉ ูุงููุงููููุฉ.",
      c8:"<strong>ุงูุจูุฏ ุงูุซุงูู โ ุฃุญูุงู ุนุงูุฉ:</strong><br>ูู ุญุงู ุญุฏูุซ ุฎูุงู ุจูู ุงูุทุฑูููุ ูุชู ุญูู ูุฏููุงุ ูุฅุฐุง ุชุนุฐุฑ ุฐูู ููุญุงู ุงููุฒุงุน ุฅูู ุงูุฌูุงุช ุงููุถุงุฆูุฉ ุงููุฎุชุตุฉ. ูุนุชุจุฑ ูุฐุง ุงูุนูุฏ ุจูุงูู ุจููุฏู ููุฒููุง ููุทุฑููู ุจูุฌุฑุฏ ุชูููุนู.",
      c9:"<strong>ุงูุจูุฏ ุงูุชุงุณุน โ ุญุตุฑูุฉ ุงูุชุนุงูุฏ:</strong><br>ูู ุญุงู ุงูุชุดุงู ุฃู ุงูุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ูุณุฌู ุฃู ูุชุนุงูุฏ ูุน ููุงูุฉ ุฃุฎุฑู ุฎูุงู ูุชุฑุฉ ุณุฑูุงู ูุฐุง ุงูุนูุฏุ ูุญู ููุทุฑู ุงูุฃูู (ุงูููุงูุฉ) ุงุชุฎุงุฐ ุงูุฅุฌุฑุงุกุงุช ุงููุงุฒูุฉ ูู ุฎูุงู ุฅุฏุงุฑุฉ ุงูุชุทุจููุ ุจูุง ูู ุฐูู ุฅููุงู ุงููุดุงุท ุฃู ุฅููุงุก ุงูุชุนุงูุฏ ููุฑูุง ุฏูู ุฃู ุชุนููุถ.",
      c10:"<strong>ุงูุจูุฏ ุงูุนุงุดุฑ โ ุงูุญู ูู ุงููุทุงูุจุฉ ุงููุงููููุฉ:</strong><br>ูุญู ููุทุฑู ุงูุซุงูู (ุตุงูุน ุงููุญุชูู) ุงููุฌูุก ุฅูู ุงูุฌูุงุช ุงููุงููููุฉ ุงููุฎุชุตุฉ ูููุงุถุงุฉ ุงูุทุฑู ุงูุฃูู (ุงูููุงูุฉ) ูู ุญุงู ุนุฏู ุงุณุชูุงู ุงูุฃุฌุฑ ุงููุชูู ุนููู ูู ุงูููุงุนูุฏ ุงููุญุฏุฏุฉุ ูุน ุงุญุชูุงุธู ุจูุงูุฉ ุญูููู ุงููุงููุฉ ูุงููุงููููุฉ."
    },
    en:{title:"Content Creator Contract โ Theeb Middle East Agency",
      form:{contractData:"Contract Details",date:"Contract Date",place:"Signing Place",party1:"Party A (Agency)",agencyName:"Agency Name",taxId:"Registry/Tax No. (optional)",agencyRep:"Agency Representative",phone:"Phone",address:"Address",party1Fixed:"* Party A details are fixed as requested.",party2:"Party B (Creator)",name:"Full Name",idNum:"ID/Passport No.",phone2:"Phone",email:"Email",likee:"Likee ID",address2:"Address",idPhotos:"ID Photos (Party B)",idFront:"ID Front",idBack:"ID Back",idNote:"* Photos are embedded in the contract automatically when saving PDF.",signatures:"Digital Signatures",targets:"Monthly Target",targetsHint:"Edit the table and add rows as needed.",autoSave:"Draft is saved automatically on your device."},
      sig:{agency:"Party A Signature (Agency)",creator:"Party B Signature (Creator)",clear:"Clear",save:"Save Signature",note:"Draw with mouse or finger, then click Save."},
      table:{month:"Month",target:"Target",pay:"Compensation (EGP/USD)"},
      m:{jan:"January",feb:"February"},
      btn:{addRow:"+ Add Row",apply:"Update Preview",print:"Save PDF",clear:"Clear Fields"},
      doc:{title:"Content Creator Contract",between:"Between:",party1:"(Party A)",and:"and",party2:"(Party B)",badge:"Confidential โ Contract Use Only",date:"Contract Date:",place:"Place:",preambleTitle:"Preamble:",preambleText:"Both parties agree to enter into this contract, and all clauses herein are binding on both parties:",party1Label:"Party A:",party2Label:"Party B:",clausesTitle:"๐ Contract Clauses โ Theeb Middle East Agency",idTitle:"๐ชช Party B ID Photos",idFrontCap:"ID Front",idBackCap:"ID Back",idNote:"* Photos are used for contracting purposes only.",signAgency:"Party A Signature (Agency)",signCreator:"Party B Signature (Creator)",name:"Name:",tableTitle:"๐ Attached Target Table",tableNote:"* The table is an integral part of this contract and may be updated in writing by mutual agreement.",footer1:"This contract was issued on",footer2:"in",footer3:"in two original copies; each party holds one."},
      c1:"<strong>Clause 1 โ Subject:</strong><br>Party B (Creator) shall produce and publish audio-visual content on Likee, in accordance with standards set by Party A (Theeb Middle East Agency), in return for the remuneration specified herein.",
      c2:"<strong>Clause 2 โ Term:</strong><br>The contract term starts from the date of signature for four (4) years, renewable by written agreement of both parties.",
      c3:"<strong>Clause 3 โ Remuneration:</strong><br>Monthly pay is calculated per the monthly target achieved, as per the attached target table approved by Party A. Payments shall be made within fifteen (15) business days after month-end.",
      c4Title:"<strong>Clause 4 โ Creator Obligations:</strong>", c4List:["Publish the required quantity/type of content per the work plan.","Comply with all Likee rules and policies.","Maintain a decent and professional image in all published work.","Do not work with competing platforms/entities during the contract term.","Follow the posting schedule set by Party A."],
      c5Title:"<strong>Clause 5 โ Agency Obligations:</strong>", c5List:["Provide technical support and guidance to ensure creator success.","Offer training and periodic follow-up to ensure content quality.","Disburse payments on time per agreed conditions."],
      c6:"<strong>Clause 6 โ IP:</strong><br>All rights to content produced by Party B during the contract term belong to Party A. Party B may not republish/sell such content without written consent from Party A.",
      c7:"<strong>Clause 7 โ Termination:</strong><br>Either party may terminate with at least thirty (30) daysโ written notice; both parties must settle outstanding obligations.",
      c8:"<strong>Clause 8 โ General:</strong><br>Disputes are resolved amicably; otherwise referred to competent courts. The contract is binding upon signature.",
      c9:"<strong>Clause 9 โ Exclusivity:</strong><br>If Party B is found registered/contracted with another agency during the contract term, Party A may take actions via the app administration, including suspension or immediate termination without compensation.",
      c10:"<strong>Clause 10 โ Legal Claim Right:</strong><br>Party B may pursue legal action against Party A if agreed pay is not received on time, without prejudice to all financial/legal rights."
    }
  };

  const translatable = document.querySelectorAll("[data-i18n]");
  const listTranslatable = document.querySelectorAll("[data-i18n-list]");

  function setLang(lang){
    const dict = I18N[lang];
    translatable.forEach(el=>{
      const key = el.getAttribute("data-i18n");
      const v = key.split('.').reduce((o,k)=>o&&o[k], dict);
      if(typeof v==="string") el.innerHTML = v;
    });
    listTranslatable.forEach(el=>{
      const key = el.getAttribute("data-i18n-list");
      const arr = key.split('.').reduce((o,k)=>o&&o[k], dict);
      if(Array.isArray(arr)) el.innerHTML = arr.map(x=>`<li>${x}</li>`).join("");
    });
    const months = ["m.jan","m.feb"];
    months.forEach((mk,i)=>{
      const cell = document.querySelectorAll("#targetTable tbody tr")[i]?.querySelector("td");
      if(cell){ cell.textContent = mk.split('.').reduce((o,k)=>o&&o[k], dict); }
    });
    const html = document.documentElement;
    html.lang = (lang==="ar")?"ar":"en";
    html.dir  = (lang==="ar")?"rtl":"ltr";
    document.title = dict.title;
    localStorage.setItem("theeb_lang", lang);
  }
  $("langAr").addEventListener("click", ()=>{ setLang("ar"); buildBlocks(); });
  $("langEn").addEventListener("click", ()=>{ setLang("en"); buildBlocks(); });
  setLang(localStorage.getItem("theeb_lang") || "ar");

  /* ===================== ุงูุญูุธ/ุงูุงุณุชุฑุฌุงุน ===================== */
  const fields = ["contractDate","place","agencyName","agencyReg","agencyRep","agencyPhone","agencyAddr","creatorName","creatorId","creatorPhone","creatorEmail","creatorLikee","creatorAddr"];

  function saveDraft(){
    const data = {};
    fields.forEach(f=> data[f] = $(f).value);
    data.targetHTML = $("targetTable").querySelector("tbody").innerHTML;
    data.idFrontDataURL = $("pIdFront").src || "";
    data.idBackDataURL  = $("pIdBack").src  || "";
    data.agencySigDataURL = $("pAgencySig").src || "";
    data.creatorSigDataURL= $("pCreatorSig").src || "";
    data.lang = document.documentElement.lang;
    localStorage.setItem("theeb_contract_draft", JSON.stringify(data));
  }

  (function restoreDraft(){
    try{
      const data = JSON.parse(localStorage.getItem("theeb_contract_draft")||"{}");
      if(data.lang) setLang(data.lang);
      fields.forEach(f=>{ if(data[f]!==undefined) $(f).value = data[f]; });
      if(data.targetHTML) $("targetTable").querySelector("tbody").innerHTML = data.targetHTML;
      if(data.idFrontDataURL) $("pIdFront").src = data.idFrontDataURL;
      if(data.idBackDataURL)  $("pIdBack").src  = data.idBackDataURL;
      if(data.agencySigDataURL) $("pAgencySig").src = data.agencySigDataURL;
      if(data.creatorSigDataURL) $("pCreatorSig").src = data.creatorSigDataURL;
      // ุชุซุจูุช ุจูุงูุงุช ุงูุทุฑู ุงูุฃูู
      $("agencyName").value = "THEEB EG-M1472";
      $("agencyReg").value  = "NO.898989--t";
      $("agencyRep").value  = "Ahmed Rashed";
      $("agencyPhone").value= "00201091545443";
      $("agencyAddr").value = "Egypt โ Monufia โ Shebin El Kom";
    }catch(e){}
  })();

  document.addEventListener("input",(e)=>{
    if(e.target.matches("input, textarea, table[contenteditable]")) saveDraft();
  });

  /* ===================== ุถุบุท ุตูุฑ ุงููููุฉ ูุจู ุงูุฅุฏุฑุงุฌ ===================== */
  function compressAndPreview(file, outImgId, maxW=1200, quality=0.8){
    const img = new Image();
    img.onload = () => {
      const scale = Math.min(1, maxW / img.naturalWidth);
      const w = Math.round(img.naturalWidth  * scale);
      const h = Math.round(img.naturalHeight * scale);
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      const ctx = c.getContext('2d');
      ctx.drawImage(img, 0, 0, w, h);
      $(outImgId).src = c.toDataURL('image/jpeg', quality);
      saveDraft();
      URL.revokeObjectURL(img.src);
    };
    img.src = URL.createObjectURL(file);
  }

  $("idFront").addEventListener("change", e=>{
    const f=e.target.files?.[0]; if(!f) return;
    compressAndPreview(f, "pIdFront", 1200, 0.8);
  });
  $("idBack").addEventListener("change", e=>{
    const f=e.target.files?.[0]; if(!f) return;
    compressAndPreview(f, "pIdBack", 1200, 0.8);
  });

  /* ===================== ุชูููุน ุฑููู ===================== */
  function setupSignature(canvasId, saveBtnId, clearBtnId, imgOutId){
    const canvas = $(canvasId), ctx = canvas.getContext("2d");
    let drawing=false, last={x:0,y:0}, scale=1;

    function resizeForDPR(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(window.devicePixelRatio||1,1);
      canvas.width  = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      scale = dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = "#111";
    }
    setTimeout(resizeForDPR,0);
    window.addEventListener("resize", ()=>{ 
      const img = new Image(); img.onload=()=>{ resizeForDPR(); ctx.drawImage(img,0,0,canvas.width/scale,canvas.height/scale); };
      img.src = $(imgOutId).src || "";
    });

    function pos(e){
      const r = canvas.getBoundingClientRect();
      const p = (e.touches && e.touches[0]) || e;
      return {x:(p.clientX - r.left), y:(p.clientY - r.top)};
    }
    function start(e){ e.preventDefault(); drawing=true; last=pos(e); }
    function move(e){
      if(!drawing) return;
      const p = pos(e);
      ctx.beginPath(); ctx.moveTo(last.x, last.y); ctx.lineTo(p.x, p.y); ctx.stroke();
      last = p;
    }
    function end(){ drawing=false; }

    canvas.addEventListener("pointerdown", start);
    canvas.addEventListener("pointermove", move);
    window.addEventListener("pointerup", end);
    canvas.addEventListener("touchstart", start, {passive:false});
    canvas.addEventListener("touchmove", move, {passive:false});
    window.addEventListener("touchend", end);

    $(clearBtnId).addEventListener("click", ()=>{
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0,0,rect.width,rect.height);
      $(imgOutId).removeAttribute("src");
      saveDraft();
    });
    $(saveBtnId).addEventListener("click", ()=>{
      const rect = canvas.getBoundingClientRect();
      const tmp = document.createElement("canvas");
      tmp.width = rect.width; tmp.height = rect.height;
      const tctx = tmp.getContext("2d");
      tctx.drawImage(canvas,0,0,rect.width,rect.height);
      $(imgOutId).src = tmp.toDataURL("image/png");
      saveDraft();
      alert(document.documentElement.lang==="ar"?"ุชู ุญูุธ ุงูุชูููุน.":"Signature saved.");
    });
  }
  setupSignature("sigAgency","sigAgencySave","sigAgencyClear","pAgencySig");
  setupSignature("sigCreator","sigCreatorSave","sigCreatorClear","pCreatorSig");

  /* ===================== ุฌุฏูู ุงูุชุงุฑุฌูุช ===================== */
  $("addRowBtn").addEventListener("click", ()=>{
    const tr=document.createElement("tr");
    tr.innerHTML="<td>โ</td><td>โ</td><td>โ</td>";
    $("targetTable").querySelector("tbody").appendChild(tr);
    saveDraft();
  });

  /* ===================== ุชูููุฏ ุงููุนุงููุฉ ===================== */
  function buildBlocks(){
    const lang = document.documentElement.lang;
    const dict = I18N[lang];

    const agencyBlock = `
      <strong>${$("agencyName").value}</strong><br>
      ${dict.form.agencyRep}: ${$("agencyRep").value}<br>
      ${dict.form.phone}: ${$("agencyPhone").value}<br>
      ${dict.form.taxId}: ${$("agencyReg").value}<br>
      ${dict.form.address}: ${$("agencyAddr").value}
    `;
    const creatorBlock = `
      <strong>${$("creatorName").value || "โ"}</strong><br>
      ${dict.form.idNum}: ${$("creatorId").value || "โ"}<br>
      ${dict.form.phone2}: ${$("creatorPhone").value || "โ"}<br>
      ${dict.form.email}: ${$("creatorEmail").value || "โ"}<br>
      Likee ID: ${$("creatorLikee").value || "โ"}<br>
      ${dict.form.address2}: ${$("creatorAddr").value || "โ"}
    `;
    $("pAgencyBlock").innerHTML = agencyBlock;
    $("pCreatorBlock").innerHTML = creatorBlock;

    $("pAgencyName").textContent = $("agencyName").value;
    $("pCreatorName").textContent = $("creatorName").value || "โ";
    $("pAgencyRepSign").textContent = $("agencyRep").value;
    $("pCreatorSign").textContent = $("creatorName").value || "โ";

    const d = $("contractDate").value ? new Date($("contractDate").value) : null;
    const fmt = (date)=> date ? date.toLocaleDateString(lang==="ar"?'ar-EG':'en-GB',{year:'numeric',month:'long',day:'numeric'}) : "โ";
    const place = $("place").value || (lang==="ar"?"ุงููุงูุฑุฉ โ ูุตุฑ":"Cairo โ Egypt");
    $("pDate").textContent  = fmt(d);
    $("pPlace").textContent = place;
    $("pDate2").textContent = fmt(d);
    $("pPlace2").textContent= place;

    document.querySelector('[data-i18n="c1"]').innerHTML = dict.c1;
    document.querySelector('[data-i18n="c2"]').innerHTML = dict.c2;
    document.querySelector('[data-i18n="c3"]').innerHTML = dict.c3;
    document.querySelector('[data-i18n="c4Title"]').innerHTML = dict.c4Title;
    document.querySelector('[data-i18n-list="c4List"]').innerHTML = dict.c4List.map(x=>`<li>${x}</li>`).join("");
    document.querySelector('[data-i18n="c5Title"]').innerHTML = dict.c5Title;
    document.querySelector('[data-i18n-list="c5List"]').innerHTML = dict.c5List.map(x=>`<li>${x}</li>`).join("");
    document.querySelector('[data-i18n="c6"]').innerHTML = dict.c6;
    document.querySelector('[data-i18n="c7"]').innerHTML = dict.c7;
    document.querySelector('[data-i18n="c8"]').innerHTML = dict.c8;
    document.querySelector('[data-i18n="c9"]').innerHTML = dict.c9;
    document.querySelector('[data-i18n="c10"]').innerHTML = dict.c10;

    const clone = $("targetTable").cloneNode(true);
    clone.removeAttribute("id");
    clone.querySelector("tbody").removeAttribute("contenteditable");
    $("pTargetTable").innerHTML = "";
    $("pTargetTable").appendChild(clone);

    saveDraft();
  }
  $("applyBtn").addEventListener("click", buildBlocks);

  /* ===================== ุญูุธ PDF (ุชุตููุฑ ุงูุตูุญุฉ) โ SCALE=1.3 / QUALITY=0.75 ===================== */
  async function saveAsPDF(){
    buildBlocks();
    if (document.fonts && document.fonts.ready) { try { await document.fonts.ready; } catch(e){} }

    if (!(window.jspdf && window.jspdf.jsPDF) || typeof html2canvas === 'undefined'){
      alert("ุงูููุชุจุงุช ุบูุฑ ูุญูููุฉ (jsPDF/html2canvas).");
      return;
    }
    const { jsPDF } = window.jspdf;

    const element = document.getElementById('doc');
    const prevWidth = element.style.width;
    element.style.width = '794px'; // ุชุฃููุฏ ููุงุณ A4 ุฃุซูุงุก ุงูุงูุชูุงุท
    await new Promise(r => requestAnimationFrame(r));

    const SCALE = 1.3;
    const QUALITY = 0.75;

    const canvas = await html2canvas(element, {
      scale: SCALE,
      useCORS: true,
      backgroundColor: '#ffffff',
      windowWidth: element.scrollWidth
    });
    const imgData = canvas.toDataURL('image/jpeg', QUALITY);

    const pdf = new jsPDF('p','pt','a4');
    const pageWidth  = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    const imgWidth  = pageWidth;
    const imgHeight = canvas.height * imgWidth / canvas.width;

    let heightLeft = imgHeight;
    let position   = 0;

    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
    heightLeft -= pageHeight;

    while (heightLeft > 5) {
      position = -(imgHeight - heightLeft);
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
      heightLeft -= pageHeight;
    }

    element.style.width = prevWidth;

    const name = (document.getElementById('creatorName').value || 'Creator').replace(/[\\/:"*?<>|]+/g,'_');
    const dateStr = (document.getElementById('contractDate').value || new Date().toISOString().slice(0,10));
    
    const fileName = `Theeb-Contract-${name}-${dateStr}.pdf`;
    const pdfBlob = pdf.output('blob');
    // ุฃููุงู: ุงุญูุธ ูุณุฎุฉ ูููุณุชุฎุฏู
    pdf.save(fileName);
    // ุซุงูููุง: ุงุฑูุน ูุณุฎุฉ ุชููุงุฆููุง ุฅูู Dropbox ุนุจุฑ Worker
    try{
      const up = await uploadToDropbox(pdfBlob, fileName);
      console.log('Dropbox upload OK:', up);
      alert(`ุชู ุฑูุน ูุณุฎุฉ ุฅูู Dropbox โ
ุฑุงุจุท ุงูุชุญููู: ${up.url}`);
    }catch(err){
      console.error('Dropbox upload failed:', err);
      // ูุง ูููุน ุงูุญูุธ ุงููุญูู ุฅุฐุง ูุดู ุงูุฑูุน
    }

  }
  $("savePdfBtn").addEventListener("click", saveAsPDF);
  $("savePdfBtn2").addEventListener("click", saveAsPDF);

  /* ===================== ูุณุญ ุงูุญููู ===================== */
  $("clearBtn").addEventListener("click", ()=>{
    const confirmMsg = document.documentElement.lang==="ar" ? "ูู ุชุฑูุฏ ูุณุญ ุฌููุน ุงูุญููู ูุงูุตูุฑ ูุงูุชูููุนุงุช (ุณูุชู ุฅุจูุงุก ุจูุงูุงุช ุงูุทุฑู ุงูุฃูู)ุ" : "Clear all fields, photos, and signatures? (Party A details remain)";
    if(!confirm(confirmMsg)) return;
    ["contractDate","place","creatorName","creatorId","creatorPhone","creatorEmail","creatorLikee","creatorAddr"].forEach(f=> $(f).value = "");
    document.querySelector("#targetTable tbody").innerHTML = `<tr><td data-i18n="m.jan">ููุงูุฑ</td><td>โ</td><td>โ</td></tr>`;
    ["pIdFront","pIdBack","pAgencySig","pCreatorSig"].forEach(id=> $(id).removeAttribute("src"));
    saveDraft();
    buildBlocks();
  });

  // ูุนุงููุฉ ุฃูููุฉ
  buildBlocks();
</script>
</body>
</html>
